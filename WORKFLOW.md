# ğŸ“Š Rabbit AI Avatar - è©³ç´°ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€Rabbit AI Avatarã‚·ã‚¹ãƒ†ãƒ ã®è©³ç´°ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ç›®æ¬¡

- [å…¨ä½“ãƒ•ãƒ­ãƒ¼å›³](#å…¨ä½“ãƒ•ãƒ­ãƒ¼å›³)
- [ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³](#ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³)
- [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³)
- [æ„Ÿæƒ…ãƒ•ãƒ­ãƒ¼](#æ„Ÿæƒ…ãƒ•ãƒ­ãƒ¼)
- [æ˜ ç”»æ¤œç´¢Tool Useãƒ•ãƒ­ãƒ¼](#æ˜ ç”»æ¤œç´¢tool-useãƒ•ãƒ­ãƒ¼)

---

## å…¨ä½“ãƒ•ãƒ­ãƒ¼å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                  USER INTERACTION                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  User types: "ãŠã™ã™ã‚ã®ã‚¢ãƒ‹ãƒ¡æ˜ ç”»ã‚’æ•™ãˆã¦"                                   â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  ChatInput Component â†’ WebSocket.send({ type: "text_input", text: "..." }) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: WebSocketé€šä¿¡ (Frontend â†’ Backend)                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Message: { "type": "text_input", "text": "ãŠã™ã™ã‚ã®ã‚¢ãƒ‹ãƒ¡æ˜ ç”»ã‚’æ•™ãˆã¦" }    â”‚  â”‚
â”‚  â”‚  Protocol: ws://localhost:3001/ws                                           â”‚  â”‚
â”‚  â”‚  Connection: Persistent WebSocket                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: Backendå‡¦ç†é–‹å§‹                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  WebSocket Handler receives message                                         â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  Start ConversationTimer (performance tracking)                             â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  Send status: { type: "status", status: "thinking", emotion: "thinking" }  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: Claude APIå‘¼ã³å‡ºã— (â±ï¸ ~500-2000ms)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Model: claude-3-5-haiku-20241022                                           â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  System Prompt: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š + æ„Ÿæƒ…ã‚¿ã‚°æŒ‡ç¤º                               â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  User Message: "ãŠã™ã™ã‚ã®ã‚¢ãƒ‹ãƒ¡æ˜ ç”»ã‚’æ•™ãˆã¦"                                 â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  Tool Available: search_movies (æ˜ ç”»æ¤œç´¢)                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Tool Use Decision â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚                                                                  â”‚             â”‚
â”‚  â”‚   Claude detects movie-related query                            â”‚             â”‚
â”‚  â”‚   â†“                                                              â”‚             â”‚
â”‚  â”‚   Returns: tool_use { name: "search_movies", input: {...} }     â”‚             â”‚
â”‚  â”‚                                                                  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¤œç´¢ (â±ï¸ ~10-50ms)                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Query: SELECT * FROM movies WHERE genre @> '{ã‚¢ãƒ‹ãƒ¡}' ORDER BY rating     â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  Results: [{ title_ja: "åƒã¨åƒå°‹ã®ç¥éš ã—", rating: 8.6, ... }, ...]        â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  Return to Claude as tool_result                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 6: Claudeæœ€çµ‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Claude processes tool_result and generates response                        â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  Response Format:                                                           â”‚  â”‚
â”‚  â”‚  "[EMOTION:excited]                                                         â”‚  â”‚
â”‚  â”‚   ã‚¢ãƒ‹ãƒ¡æ˜ ç”»ã§ã™ã­ï¼ãŠã™ã™ã‚ã‚’ã„ãã¤ã‹ç´¹ä»‹ã—ã¾ã™ã­ï¼                          â”‚  â”‚
â”‚  â”‚   1. åƒã¨åƒå°‹ã®ç¥éš ã— - å®®å´é§¿ç›£ç£ã®åä½œã§ã™..."                             â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  Parse: { emotion: "excited", text: "ã‚¢ãƒ‹ãƒ¡æ˜ ç”»ã§ã™ã­ï¼..." }               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 7: ãƒ†ã‚­ã‚¹ãƒˆãƒ¬ã‚¹ãƒãƒ³ã‚¹é€ä¿¡                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  WebSocket.send({                                                           â”‚  â”‚
â”‚  â”‚    type: "assistant_message",                                               â”‚  â”‚
â”‚  â”‚    text: "ã‚¢ãƒ‹ãƒ¡æ˜ ç”»ã§ã™ã­ï¼ãŠã™ã™ã‚ã‚’ã„ãã¤ã‹ç´¹ä»‹ã—ã¾ã™ã­ï¼...",            â”‚  â”‚
â”‚  â”‚    emotion: "excited"                                                       â”‚  â”‚
â”‚  â”‚  })                                                                         â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  Frontend: ChatHistory ã«è¿½åŠ  + Avatar emotion æ›´æ–°                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 8: Azure TTSéŸ³å£°åˆæˆ (â±ï¸ ~300-800ms)                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Voice: ja-JP-NanamiNeural (female)                                         â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  SSML Generation with emotion:                                              â”‚  â”‚
â”‚  â”‚  <speak>                                                                    â”‚  â”‚
â”‚  â”‚    <voice name="ja-JP-NanamiNeural">                                        â”‚  â”‚
â”‚  â”‚      <mstts:express-as style="cheerful" styledegree="1.8">                  â”‚  â”‚
â”‚  â”‚        ã‚¢ãƒ‹ãƒ¡æ˜ ç”»ã§ã™ã­ï¼ãŠã™ã™ã‚ã‚’ã„ãã¤ã‹ç´¹ä»‹ã—ã¾ã™ã­ï¼...                 â”‚  â”‚
â”‚  â”‚      </mstts:express-as>                                                    â”‚  â”‚
â”‚  â”‚    </voice>                                                                 â”‚  â”‚
â”‚  â”‚  </speak>                                                                   â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  Output: MP3 audio buffer â†’ Base64 encode                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 9: éŸ³å£°ãƒ‡ãƒ¼ã‚¿é€ä¿¡                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  WebSocket.send({                                                           â”‚  â”‚
â”‚  â”‚    type: "audio",                                                           â”‚  â”‚
â”‚  â”‚    data: "base64EncodedAudioData...",                                       â”‚  â”‚
â”‚  â”‚    format: "mp3"                                                            â”‚  â”‚
â”‚  â”‚  })                                                                         â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  Send status: { type: "status", status: "speaking", emotion: "excited" }   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 10: FrontendéŸ³å£°å†ç”Ÿ                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  useAudioPlayer hook receives audio data                                    â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  Create Audio element with data URI                                         â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  audio.play() â†’ User hears response                                         â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  Avatar shows: (â˜…â–½â˜…) ã€ãƒ¯ã‚¯ãƒ¯ã‚¯ã€‘ğŸ”Š è©±ã—ã¦ã„ã¾ã™...                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 11: ã‚¿ã‚¤ãƒŸãƒ³ã‚°æƒ…å ±é€ä¿¡                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  WebSocket.send({                                                           â”‚  â”‚
â”‚  â”‚    type: "timing",                                                          â”‚  â”‚
â”‚  â”‚    timings: [                                                               â”‚  â”‚
â”‚  â”‚      { action: "LLM (Claude 3.5 Haiku)", durationMs: 1250 },               â”‚  â”‚
â”‚  â”‚      { action: "DB (Movie Search)", durationMs: 35 },                       â”‚  â”‚
â”‚  â”‚      { action: "TTS (Azure Neural)", durationMs: 520 }                      â”‚  â”‚
â”‚  â”‚    ],                                                                       â”‚  â”‚
â”‚  â”‚    totalMs: 1810                                                            â”‚  â”‚
â”‚  â”‚  })                                                                         â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  TimingDisplay component shows performance breakdown                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 12: å®Œäº†ãƒ»å¾…æ©ŸçŠ¶æ…‹ã¸                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Send status: { type: "status", status: "idle", emotion: "excited" }       â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  Avatar returns to idle: (â˜…â–½â˜…) ã€ãƒ¯ã‚¯ãƒ¯ã‚¯ã€‘                                 â”‚  â”‚
â”‚  â”‚  â†“                                                                          â”‚  â”‚
â”‚  â”‚  Ready for next user input                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User  â”‚     â”‚ Frontend â”‚     â”‚  WebSocket â”‚     â”‚ Backend â”‚     â”‚  Claude  â”‚     â”‚ Azure  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚ Type message  â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚ text_input       â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚ Forward message â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚ status:thinking  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚  Show avatar  â”‚                  â”‚                 â”‚ â±ï¸ START      â”‚               â”‚
    â”‚  (ãƒ»_ãƒ»?)     â”‚                  â”‚                 â”‚ Chat request  â”‚               â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚  tool_use:    â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚  search_moviesâ”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚â”€â”             â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚ â”‚ DB Query    â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚<â”˜             â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚ tool_result   â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚ Final responseâ”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚ [EMOTION:...] â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚ â±ï¸ STOP LLM   â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚ assistant_messageâ”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚  Show message â”‚                  â”‚                 â”‚ â±ï¸ START TTS  â”‚               â”‚
    â”‚  + emotion    â”‚                  â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚  SSML + text  â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚  Audio buffer â”‚
    â”‚               â”‚                  â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚               â”‚                  â”‚                 â”‚ â±ï¸ STOP TTS   â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚ status:speaking  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚ audio (base64)   â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚  Play audio   â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚  ğŸ”Š           â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚ timing info      â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚  Show timing  â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚  â±ï¸ 1.8s      â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚ status:idle      â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚  Ready        â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚  (â—•â€¿â—•)       â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                 â”‚               â”‚               â”‚
    â”‚               â”‚                  â”‚                 â”‚               â”‚               â”‚
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³

```
æ™‚é–“ (ms)    0        500       1000      1500      2000      2500
             â”‚         â”‚         â”‚         â”‚         â”‚         â”‚
             â–¼         â–¼         â–¼         â–¼         â–¼         â–¼
User Input   â—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
             â”‚
             â”œâ”€ WebSocketé€ä¿¡ (~5ms)
             â”‚
LLMå‡¦ç†      â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
             â”‚ â””â”€â”€ Claude API (500-2000ms)
             â”‚         â”‚
             â”‚         â”œâ”€ Tool Useæ¤œå‡º
             â”‚         â”‚
DBæ¤œç´¢       â”‚         â”‚â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
             â”‚         â”‚â””â”€â”€ PostgreSQL Query (10-50ms)
             â”‚         â”‚
LLMç¶šè¡Œ      â”‚         â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
             â”‚         â”‚â””â”€â”€ Final Responseç”Ÿæˆ
             â”‚                     â”‚
ãƒ†ã‚­ã‚¹ãƒˆå¿œç­”  â”‚                     â—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
             â”‚                     â”‚
TTSå‡¦ç†      â”‚                     â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
             â”‚                     â”‚â””â”€â”€ Azure Neural TTS (300-800ms)
             â”‚                                       â”‚
éŸ³å£°é€ä¿¡     â”‚                                       â—â”â”â”â”â”â”â”â”â”â”â”
             â”‚                                       â”‚
éŸ³å£°å†ç”Ÿ     â”‚                                       â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
             â”‚                                       â”‚â””â”€â”€ Audio Playback
             â”‚                                                   â”‚
å®Œäº†         â”‚                                                   â—
             â”‚
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
             â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Total: ~1.5-3.0s â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

| å‡¦ç† | æœ€å° | å¹³å‡ | æœ€å¤§ | å‚™è€ƒ |
|------|------|------|------|------|
| WebSocketé€ä¿¡ | 1ms | 5ms | 20ms | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¾å­˜ |
| LLM (Claude) | 500ms | 1000ms | 2000ms | å…¥åŠ›é•·ãƒ»Tool Useæœ‰ç„¡ã§å¤‰å‹• |
| DBæ¤œç´¢ | 5ms | 20ms | 100ms | ã‚¯ã‚¨ãƒªè¤‡é›‘åº¦ä¾å­˜ |
| TTS (Azure) | 200ms | 400ms | 800ms | ãƒ†ã‚­ã‚¹ãƒˆé•·ä¾å­˜ |
| **åˆè¨ˆ** | **800ms** | **1500ms** | **3000ms** | |

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ãƒã‚¤ãƒ³ãƒˆ

1. **LLMæœ€é©åŒ–**: Claude 3.5 Haikuã¯é«˜é€Ÿãƒ¢ãƒ‡ãƒ«ã€‚é•·ã„ä¼šè©±å±¥æ­´ã¯20ã‚¿ãƒ¼ãƒ³ã«åˆ¶é™
2. **DBæœ€é©åŒ–**: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½¿ç”¨ã€çµæœã‚’10ä»¶ã«åˆ¶é™
3. **TTSæœ€é©åŒ–**: MP3å½¢å¼ã§åœ§ç¸®ã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œäºˆå®š
4. **ä¸¦åˆ—å‡¦ç†**: ãƒ†ã‚­ã‚¹ãƒˆå¿œç­”ã¨TTSç”Ÿæˆã‚’ä¸¦åˆ—åŒ–å¯èƒ½ï¼ˆå°†æ¥å®Ÿè£…ï¼‰

---

## æ„Ÿæƒ…ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        EMOTION FLOW                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  User Input                                                           â”‚
â”‚      â”‚                                                                â”‚
â”‚      â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Claude Analysis                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚  Input: "ãŠã™ã™ã‚ã®ã‚¢ãƒ‹ãƒ¡æ˜ ç”»ã‚’æ•™ãˆã¦"                    â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â†“                                                       â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  Sentiment: Positive, Curious                            â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â†“                                                       â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  Selected Emotion: excited (ãƒ¯ã‚¯ãƒ¯ã‚¯)                    â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â†“                                                       â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  Output: [EMOTION:excited] + Response text               â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚      â”‚                                                                â”‚
â”‚      â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Emotion â†’ TTS Style Mapping                                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ Emotion       â”‚ Azure TTS Style â”‚ Style Degree            â”‚  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ â”‚
â”‚  â”‚  â”‚ happy         â”‚ cheerful        â”‚ 1.2                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ excited       â”‚ cheerful        â”‚ 1.8 (ã‚ˆã‚Šå¼·èª¿)          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ sad           â”‚ sad             â”‚ 1.0                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ thinking      â”‚ calm            â”‚ 0.8                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ neutral       â”‚ default         â”‚ 1.0                     â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚      â”‚                                                                â”‚
â”‚      â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Avatar Display Update                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚                                                          â”‚    â”‚ â”‚
â”‚  â”‚  â”‚     Before: (ãƒ»_ãƒ»?) ã€è€ƒãˆä¸­ã€‘ ğŸ’­ è€ƒãˆä¸­...             â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                         â†“                                â”‚    â”‚ â”‚
â”‚  â”‚  â”‚     After:  (â˜…â–½â˜…) ã€ãƒ¯ã‚¯ãƒ¯ã‚¯ã€‘ ğŸ”Š è©±ã—ã¦ã„ã¾ã™...        â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                                                          â”‚    â”‚ â”‚
â”‚  â”‚  â”‚     Color: #EF4444 (Red for excited)                     â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                                                          â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ„Ÿæƒ…ãƒãƒƒãƒ”ãƒ³ã‚°è©³ç´°

| æ„Ÿæƒ… | é¡”æ–‡å­— | ãƒ©ãƒ™ãƒ« | è‰² | Azure TTS Style | ç”¨é€” |
|------|--------|--------|-----|-----------------|------|
| neutral | (ãƒ»Ï‰ãƒ») | æ™®é€š | #6B7280 | default | é€šå¸¸ã®ä¼šè©± |
| happy | (â—•â€¿â—•) | å¬‰ã—ã„ | #F59E0B | cheerful | ãƒã‚¸ãƒ†ã‚£ãƒ–ãªè©±é¡Œ |
| excited | (â˜…â–½â˜…) | ãƒ¯ã‚¯ãƒ¯ã‚¯ | #EF4444 | cheerful (1.8) | èˆˆå¥®ã™ã‚‹è©±é¡Œ |
| thinking | (ãƒ»_ãƒ»?) | è€ƒãˆä¸­ | #06B6D4 | calm | é›£ã—ã„è³ªå• |
| sad | (Â´ãƒ»Ï‰ãƒ»`) | æ‚²ã—ã„ | #6B7280 | sad | ãƒã‚¬ãƒ†ã‚£ãƒ–ãªè©±é¡Œ |
| surprised | (Â°oÂ°) | é©šã | #F59E0B | cheerful | æ„å¤–ãªæƒ…å ± |
| confused | (ãƒ»ãƒ»?) | å›°æƒ‘ | #8B5CF6 | disgruntled | ä¸æ˜ç¢ºãªè³ªå• |
| listening | (ãƒ»Ï‰ãƒ»)ğŸ¤ | èã„ã¦ã„ã¾ã™ | #10B981 | - | éŸ³å£°å…¥åŠ›ä¸­ |
| speaking | (ãƒ»Ï‰ãƒ»)â™ª | è©±ã—ã¦ã„ã¾ã™ | #3B82F6 | - | éŸ³å£°å‡ºåŠ›ä¸­ |

---

## æ˜ ç”»æ¤œç´¢Tool Useãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MOVIE SEARCH TOOL USE FLOW                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  1. User Query                                                        â”‚
â”‚     "å®®å´é§¿ã®æ˜ ç”»ã‚’æ•™ãˆã¦"                                            â”‚
â”‚         â”‚                                                             â”‚
â”‚         â–¼                                                             â”‚
â”‚  2. Claude Initial Response                                           â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚     â”‚ {                                                              â”‚â”‚
â”‚     â”‚   "stop_reason": "tool_use",                                   â”‚â”‚
â”‚     â”‚   "content": [{                                                â”‚â”‚
â”‚     â”‚     "type": "tool_use",                                        â”‚â”‚
â”‚     â”‚     "name": "search_movies",                                   â”‚â”‚
â”‚     â”‚     "input": {                                                 â”‚â”‚
â”‚     â”‚       "query": "å®®å´é§¿",                                       â”‚â”‚
â”‚     â”‚       "genre": null                                            â”‚â”‚
â”‚     â”‚     }                                                          â”‚â”‚
â”‚     â”‚   }]                                                           â”‚â”‚
â”‚     â”‚ }                                                              â”‚â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚         â”‚                                                             â”‚
â”‚         â–¼                                                             â”‚
â”‚  3. Execute Database Query                                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚     â”‚ SELECT * FROM movies                                           â”‚â”‚
â”‚     â”‚ WHERE director ILIKE '%å®®å´é§¿%'                                â”‚â”‚
â”‚     â”‚    OR title_ja ILIKE '%å®®å´é§¿%'                                â”‚â”‚
â”‚     â”‚    OR description ILIKE '%å®®å´é§¿%'                             â”‚â”‚
â”‚     â”‚ ORDER BY rating DESC                                           â”‚â”‚
â”‚     â”‚ LIMIT 10;                                                      â”‚â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚         â”‚                                                             â”‚
â”‚         â–¼                                                             â”‚
â”‚  4. Query Results                                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚     â”‚ [                                                              â”‚â”‚
â”‚     â”‚   {                                                            â”‚â”‚
â”‚     â”‚     "title_ja": "åƒã¨åƒå°‹ã®ç¥éš ã—",                            â”‚â”‚
â”‚     â”‚     "title_en": "Spirited Away",                               â”‚â”‚
â”‚     â”‚     "director": "å®®å´é§¿",                                      â”‚â”‚
â”‚     â”‚     "rating": 8.6,                                             â”‚â”‚
â”‚     â”‚     "release_year": 2001                                       â”‚â”‚
â”‚     â”‚   },                                                           â”‚â”‚
â”‚     â”‚   {                                                            â”‚â”‚
â”‚     â”‚     "title_ja": "ã‚‚ã®ã®ã‘å§«",                                  â”‚â”‚
â”‚     â”‚     "rating": 8.4,                                             â”‚â”‚
â”‚     â”‚     ...                                                        â”‚â”‚
â”‚     â”‚   },                                                           â”‚â”‚
â”‚     â”‚   ...                                                          â”‚â”‚
â”‚     â”‚ ]                                                              â”‚â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚         â”‚                                                             â”‚
â”‚         â–¼                                                             â”‚
â”‚  5. Send tool_result to Claude                                        â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚     â”‚ {                                                              â”‚â”‚
â”‚     â”‚   "role": "user",                                              â”‚â”‚
â”‚     â”‚   "content": [{                                                â”‚â”‚
â”‚     â”‚     "type": "tool_result",                                     â”‚â”‚
â”‚     â”‚     "tool_use_id": "...",                                      â”‚â”‚
â”‚     â”‚     "content": "[{title_ja: åƒã¨åƒå°‹..., ...}]"               â”‚â”‚
â”‚     â”‚   }]                                                           â”‚â”‚
â”‚     â”‚ }                                                              â”‚â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚         â”‚                                                             â”‚
â”‚         â–¼                                                             â”‚
â”‚  6. Claude Final Response                                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚     â”‚ "[EMOTION:excited]                                             â”‚â”‚
â”‚     â”‚  å®®å´é§¿ç›£ç£ã®æ˜ ç”»ã§ã™ã­ï¼ç´ æ™´ã‚‰ã—ã„ä½œå“ãŒãŸãã•ã‚“ã‚ã‚Šã¾ã™ï¼    â”‚â”‚
â”‚     â”‚                                                                â”‚â”‚
â”‚     â”‚  1. åƒã¨åƒå°‹ã®ç¥éš ã— (2001) - è©•ä¾¡: 8.6                       â”‚â”‚
â”‚     â”‚     10æ­³ã®å°‘å¥³ãƒ»åƒå°‹ãŒç¥ã€…ã®ä¸–ç•Œã§æˆé•·ã™ã‚‹ç‰©èªã§ã™ã€‚          â”‚â”‚
â”‚     â”‚                                                                â”‚â”‚
â”‚     â”‚  2. ã‚‚ã®ã®ã‘å§« (1997) - è©•ä¾¡: 8.4                             â”‚â”‚
â”‚     â”‚     äººé–“ã¨è‡ªç„¶ã®å¯¾ç«‹ã‚’æã„ãŸå£®å¤§ãªç‰©èª...                     â”‚â”‚
â”‚     â”‚                                                                â”‚â”‚
â”‚     â”‚  3. ã¨ãªã‚Šã®ãƒˆãƒˆãƒ­ (1988) - è©•ä¾¡: 8.1                         â”‚â”‚
â”‚     â”‚     å¿ƒæ¸©ã¾ã‚‹å§‰å¦¹ã¨ä¸æ€è­°ãªç”Ÿãç‰©ã®ç‰©èª..."                    â”‚â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Toolå®šç¾©

```typescript
const tools = [
  {
    name: "search_movies",
    description: "æ˜ ç”»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æ˜ ç”»ã‚’æ¤œç´¢ã—ã¾ã™ã€‚ã‚¿ã‚¤ãƒˆãƒ«ã€ã‚¸ãƒ£ãƒ³ãƒ«ã€å¹´ä»£ãªã©ã§æ¤œç´¢ã§ãã¾ã™ã€‚",
    input_schema: {
      type: "object",
      properties: {
        query: {
          type: "string",
          description: "æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã€ä¿³å„ªåã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãªã©ï¼‰",
        },
        genre: {
          type: "string",
          description: "ã‚¸ãƒ£ãƒ³ãƒ«ï¼ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€ã‚³ãƒ¡ãƒ‡ã‚£ã€ãƒ‰ãƒ©ãƒã€SFã€ãƒ›ãƒ©ãƒ¼ã€ã‚¢ãƒ‹ãƒ¡ãªã©ï¼‰",
        },
        year: {
          type: "number",
          description: "å…¬é–‹å¹´",
        },
      },
      required: ["query"],
    },
  },
];
```

### æ¤œç´¢ã‚¯ã‚¨ãƒªä¾‹

| ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ› | æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³ | æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ |
|-------------|-------------|---------------|
| "ãŠã™ã™ã‚ã®ã‚¢ãƒ‹ãƒ¡æ˜ ç”»" | ã‚¸ãƒ£ãƒ³ãƒ«æ¤œç´¢ | `{ query: "ãŠã™ã™ã‚", genre: "ã‚¢ãƒ‹ãƒ¡" }` |
| "å®®å´é§¿ã®æ˜ ç”»" | ç›£ç£æ¤œç´¢ | `{ query: "å®®å´é§¿" }` |
| "2020å¹´ã®æ˜ ç”»" | å¹´ä»£æ¤œç´¢ | `{ query: "", year: 2020 }` |
| "æ³£ã‘ã‚‹æ˜ ç”»" | ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ | `{ query: "æ³£ã‘ã‚‹" }` |

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

```sql
CREATE TABLE movies (
  id SERIAL PRIMARY KEY,
  title_ja VARCHAR(255) NOT NULL,      -- æ—¥æœ¬èªã‚¿ã‚¤ãƒˆãƒ«
  title_en VARCHAR(255),               -- è‹±èªã‚¿ã‚¤ãƒˆãƒ«
  description TEXT,                     -- ã‚ã‚‰ã™ã˜
  genre TEXT[] DEFAULT '{}',           -- ã‚¸ãƒ£ãƒ³ãƒ«é…åˆ—
  release_year INTEGER,                -- å…¬é–‹å¹´
  rating DECIMAL(2,1),                 -- è©•ä¾¡ (0.0-10.0)
  director VARCHAR(255),               -- ç›£ç£
  actors TEXT[] DEFAULT '{}',          -- å‡ºæ¼”è€…é…åˆ—
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_movies_title_ja ON movies(title_ja);
CREATE INDEX idx_movies_genre ON movies USING GIN(genre);
CREATE INDEX idx_movies_year ON movies(release_year);
CREATE INDEX idx_movies_rating ON movies(rating DESC);
```

---

## WebSocketãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ ã‚µãƒ¼ãƒãƒ¼

| Type | èª¬æ˜ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ |
|------|------|-----------|
| `text_input` | ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ | `text: string` |
| `start_listening` | éŸ³å£°å…¥åŠ›é–‹å§‹ | - |
| `stop_listening` | éŸ³å£°å…¥åŠ›åœæ­¢ | - |
| `ping` | æ¥ç¶šç¶­æŒ | - |

### ã‚µãƒ¼ãƒãƒ¼ â†’ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

| Type | èª¬æ˜ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ |
|------|------|-----------|
| `connected` | æ¥ç¶šæˆåŠŸ | `sessionId: string`, `message: string` |
| `status` | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–° | `status: string`, `emotion: string`, `statusText: string` |
| `user_message` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç¢ºèª | `text: string` |
| `assistant_message` | ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆå¿œç­” | `text: string`, `emotion: string` |
| `audio` | éŸ³å£°ãƒ‡ãƒ¼ã‚¿ | `data: string (base64)`, `format: string` |
| `timing` | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æƒ…å ± | `timings: array`, `totalMs: number` |
| `error` | ã‚¨ãƒ©ãƒ¼ | `message: string` |
| `pong` | Pingå¿œç­” | - |
